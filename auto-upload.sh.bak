#!/data/data/com.termux/files/usr/bin/bash

# Masuk ke folder project
cd /storage/emulated/0/HtmlWhatsApp || { echo "Folder tidak ditemukan!"; exit 1; }

# Konfigurasi Git (hanya kalau belum di-set)
git config --global user.name "BangKres"
git config --global user.email "email@gmail.com"

# Tambahkan safe.directory hanya jika belum ada
if ! git config --global --get-all safe.directory | grep -q "$(pwd)"; then
    git config --global --add safe.directory "$(pwd)"
fi

# Cek apakah remote sudah ada
if ! git remote get-url origin >/dev/null 2>&1; then
    git remote add origin https://github.com/BangKres/WhatsNew.git
fi

# Pastikan file yang dipantau ada
if [ ! -f index.html ] || [ ! -f login.html ]; then
    echo "File index.html atau login.html tidak ditemukan!"
    exit 1
fi

echo "Memantau perubahan index.html dan login.html..."

# Pantau perubahan file html
while inotifywait -e modify index.html login.html; do
    echo "Perubahan terdeteksi. Upload ke GitHub..."
    git add .
    git commit -m "Auto upload $(date '+%Y-%m-%d %H:%M:%S')"

    # Coba push, ulangi kalau gagal
    until git push -u origin main --force; do
        echo "Push gagal, coba lagi dalam 10 detik..."
        sleep 10
    done

    echo "Upload selesai!"
done